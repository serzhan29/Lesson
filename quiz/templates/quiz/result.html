{% extends 'base.html' %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/quiz/result.css' %}">
<header>
    <h1>Результаты Теста</h1>
    <nav>
        <a href="{% url 'quiz:quiz_list' %}">Вернуться к списку тестов</a>
    </nav>
</header>
<pre>{{ user_answers|dictsort:"0" }}</pre>

<main>
    <h2>Тест: {{ quiz.title }}</h2>
    <p><strong>Дата прохождения:</strong> {{ result.completed_at }}</p>
    <p><strong>Общее количество вопросов:</strong> {{ quiz.questions.count }}</p>
    <p><strong>Количество набранных баллов:</strong> <span id="score">{{ result.score }}</span></p>

    <h3>Детали теста</h3>
    <table>
        <thead>
            <tr>
                <th>Вопросы: </th>
                <th>Правильные ответы: </th>
            </tr>
        </thead>
        <tbody>
            {% for question in quiz.questions.all %}
            <tr>
                <td>{{ question.text }}</td>
                <td>
                    {% for answer in question.answers.all %}
                        {% if answer.is_correct %}
                            <span class="correct">{{ answer.text }}</span>
                            {% if not forloop.last %}, {% endif %}
                        {% endif %}
                    {% endfor %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</main>

</body>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Находим элемент с результатом
            var scoreElement = document.getElementById('score');
            if (scoreElement) {
                // Получаем текстовое значение и округляем его
                var score = parseFloat(scoreElement.textContent);
                if (!isNaN(score)) {
                    scoreElement.textContent = Math.floor(score);
                }
            }
        });
    </script>
</html>
{% endblock %}